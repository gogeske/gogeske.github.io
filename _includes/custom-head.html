<script>
  const languageNames = new Intl.DisplayNames(['en'], { type: 'language' });
  var greetings, last, w, style;
  window.addEventListener('load', load);
  ['touchstart', 'mousedown', 'keydown'].forEach(function(e) {
    window.addEventListener(e, greet);
  });

  function load() {
    greetings=document.querySelectorAll(".home p");
    greetings.forEach(node => { node.remove(); });
    w=document.querySelector(".wrapper"),
      style = w.style;
  }

  function getRandomNode() {
    var num = Math.floor(Math.random() * greetings.length);
    var node=greetings[num];
    if(node === last) {
      return getRandomNode();
    }
    last=node;
    return node;
  }

  function greet(e) {
    var node = getRandomNode();
    var home=document.querySelector(".home");
    var h1=document.querySelector(".home h1");
    var lang=document.querySelector("#language");
    h1.textContent=node.textContent;
    if(node.lang) {
      lang.textContent="This is hello in " + languageNames.of(node.lang) + ".";
      home.style="background-color: black;";
    } else {
      lang.textContent="";
      home.style="background-color: transparent;";
    }
    style.animation = "";
    style.webkitAnimation = "";
    void w.offsetParent;
    style.animation = "flash .3s ease";
    style.webkitAnimation = "flash .3s ease";
  }
</script>
